@baseUrl=http://localhost:8000
@contentType = application/json

### ===NOTE===
# .NET Semantic Kernel Agents Workshop - API Test Collection
# 
# This HTTP file tests the .NET Semantic Kernel API implementation
# 
# Prerequisites:
# 1. Install VS Code REST Client extension
# 2. Start the .NET API: dotnet run
# 3. Ensure Azure OpenAI credentials are configured in .env
#
# Usage: Click "Send Request" above each section to test individual endpoints

###

### 1. Health Check
# Tests basic API connectivity and configuration status
GET {{baseUrl}}/health
Accept: {{contentType}}

### 2. Get Available Agents
# Returns list of all available agents with their capabilities
GET {{baseUrl}}/agents

### 3. Single Agent Chat - Generic Agent
# Test basic chat functionality with the generic agent
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "What are the best practices for building scalable .NET applications?",
  "agent": "generic_agent",
  "session_id": "test-session-001"
}

### 4. Single Agent Chat - People Lookup
# Test specialized people lookup agent
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "Can you help me find experts in machine learning?",
  "agent": "people_lookup",
  "session_id": "test-session-002"
}

### 5. Single Agent Chat - Knowledge Finder
# Test knowledge search and retrieval agent
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "What is the latest information about Semantic Kernel?",
  "agent": "knowledge_finder",
  "session_id": "test-session-003"
}

### 6. Multi-Agent Chat via /chat endpoint
# The /chat endpoint automatically routes to group chat when multiple agents are specified
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "How should we approach building an AI-powered application? Consider both technical and business perspectives.",
  "agents": ["generic_agent", "people_lookup"],
  "session_id": "test-session-004"
}

### 7. Group Chat with Semantic Kernel - Specified Agents
# Direct group chat endpoint with multiple specialized agents
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "What are the key considerations for enterprise AI deployment? Cover security, scalability, and team management.",
  "agents": ["generic_agent", "people_lookup", "knowledge_finder"],
  "session_id": "test-session-005",
  "max_turns": 2,
  "use_semantic_kernel_groupchat": true
}

### 8. Group Chat with Auto-Selected Agents
# Let the system automatically select the most relevant agents
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "Discuss the benefits and challenges of microservices architecture",
  "session_id": "test-session-006",
  "max_turns": 1
}

### 9. Group Chat - Complex Technical Question
# Test with a complex question requiring multiple expert perspectives
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "We're planning to migrate our monolithic application to a cloud-native architecture. What should we consider for team structure, technology choices, and implementation strategy?",
  "agents": ["generic_agent", "people_lookup", "knowledge_finder"],
  "session_id": "test-session-007",
  "max_turns": 3,
  "use_semantic_kernel_groupchat": true
}

### 10. Test Agent Termination - People Question
# Test that knowledge_finder agent terminates when asked about people
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "Who are the best software engineers in our company for leading a new project?",
  "agents": ["generic_agent", "people_lookup", "knowledge_finder"],
  "session_id": "test-termination-001",
  "max_turns": 2,
  "use_semantic_kernel_groupchat": true
}

### 11. Test Agent Termination - Knowledge Question  
# Test that people_lookup agent terminates when asked about technical knowledge
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "What are the latest best practices for implementing microservices with .NET?",
  "agents": ["generic_agent", "people_lookup", "knowledge_finder"],
  "session_id": "test-termination-002",
  "max_turns": 2,
  "use_semantic_kernel_groupchat": true
}

### 12. Test Agent Termination - All Agents Relevant
# Test that no agents terminate when question is relevant to all
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "How can we build a team and knowledge base for implementing AI solutions in our organization?",
  "agents": ["generic_agent", "people_lookup", "knowledge_finder"],
  "session_id": "test-termination-003",
  "max_turns": 2,
  "use_semantic_kernel_groupchat": true
}

### 13. Reset Session - Clear Conversation History
# Reset a specific session to clear conversation history
POST {{baseUrl}}/reset
Content-Type: application/json

{
  "session_id": "test-session-001"
}

### 14. Test Session Persistence
# Test that conversation history is maintained across requests
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "Remember this number: 42",
  "agent": "generic_agent",
  "session_id": "persistence-test"
}

### 15. Test Session Persistence - Follow-up
# This should reference the previous message in the same session
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "What number did I just tell you to remember?",
  "agent": "generic_agent",
  "session_id": "persistence-test"
}

### 16. Error Handling - Missing Message
# Test error handling with invalid request
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "agent": "generic_agent",
  "session_id": "error-test"
}

### 17. Error Handling - Invalid Agent
# Test error handling with non-existent agent
POST {{baseUrl}}/chat
Content-Type: application/json

{
  "message": "Test message",
  "agent": "non_existent_agent",
  "session_id": "error-test-2"
}

### 18. Timeout-Optimized Test - Single Turn with 2 Agents
# Optimized test case to avoid timeouts
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "What are the key benefits of using AI in software development?",
  "agents": ["generic_agent", "knowledge_finder"],
  "session_id": "timeout-test-001",
  "max_turns": 1,
  "use_semantic_kernel_groupchat": true
}

### 19. People Lookup Test - Specific Person Query
# Test people_lookup agent with a specific person query (should provide helpful response, not terminate)
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "Who is Udai? Can you help me find information about this person or how to contact them?",
  "agents": ["people_lookup", "generic_agent"],
  "session_id": "people-lookup-test-001",
  "max_turns": 1,
  "use_semantic_kernel_groupchat": true
}

### 20. Performance Test - Lightweight Query
# Test with a simple question that should process quickly
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "Hello, can you introduce yourselves?",
  "agents": ["generic_agent", "people_lookup", "knowledge_finder"],
  "session_id": "performance-test-001",
  "max_turns": 1,
  "use_semantic_kernel_groupchat": true
}

### 21. Knowledge Finder Termination Test
# Test that knowledge_finder terminates when asked about finding specific people
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "Can you find Udai's contact information and phone number?",
  "agents": ["knowledge_finder", "people_lookup"],
  "session_id": "knowledge-termination-test",
  "max_turns": 1,
  "use_semantic_kernel_groupchat": true
}

### 22. People Lookup vs Knowledge Finder - Clear Distinction
# Test showing how each agent handles their domain appropriately
POST {{baseUrl}}/group-chat
Content-Type: application/json

{
  "message": "I need to research .NET best practices AND find experts in our team who know about microservices",
  "agents": ["knowledge_finder", "people_lookup", "generic_agent"],
  "session_id": "domain-distinction-test",
  "max_turns": 1,
  "use_semantic_kernel_groupchat": true
}
###
# End of API Test Collection
# 
# Tips:
# - Use different session_ids to test session isolation
# - Check response metadata for performance metrics and terminated_agents list
# - Modify messages to test different termination scenarios
# - Test cases 10-12 specifically demonstrate agent termination behavior
# - Test cases 18-20 are optimized to avoid timeout issues
# - If you encounter timeouts, reduce max_turns to 1 or use fewer agents
# - Monitor the timeout_protection metadata in responses
# - Use the Swagger UI at http://localhost:8000 for interactive documentation

### ⚠️ TIMEOUT TROUBLESHOOTING:
# If you still get timeout errors:
# 1. Reduce max_turns to 1
# 2. Use only 1-2 agents per request
# 3. Use shorter, simpler messages
# 4. Check Azure OpenAI service availability
# 5. Monitor server logs for detailed error information